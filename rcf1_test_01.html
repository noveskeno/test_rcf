<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Test Interactivo - Configurable</title>
<style>
:root{--bg:#0b132b;--card:#1c2541;--accent:#5bc0be;--ok:#21c17a;--bad:#ff5d73;--text:#f5f7ff}
*{box-sizing:border-box}
body{margin:0;font-family:Segoe UI,system-ui,-apple-system,Roboto,Ubuntu,'Helvetica Neue',Arial,sans-serif;background:linear-gradient(135deg,var(--bg),#0f1a3a);color:var(--text)}
.header{padding:24px 16px;text-align:center;border-bottom:1px solid rgba(255,255,255,.08)}
.header h1{margin-bottom:8px}
.back-btn{
  display:inline-block;margin-bottom:12px;padding:8px 16px;
  background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.15);
  border-radius:8px;color:var(--text);text-decoration:none;
  font-size:14px;transition:all .2s;
}
.back-btn:hover{background:rgba(255,255,255,.15);transform:translateY(-1px)}
.container{max-width:1000px;margin:0 auto;padding:24px}
.card{background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:20px;margin:16px 0;box-shadow:0 10px 30px rgba(0,0,0,.25)}
.q-title{font-weight:600;margin-bottom:12px}
.options{display:grid;grid-template-columns:1fr;gap:10px}
.option{background:#121a34;border:1px solid rgba(255,255,255,.08);padding:12px;border-radius:10px;display:flex;align-items:flex-start;gap:10px;cursor:pointer}
.option input{margin-top:3px}
.badge{display:inline-block;padding:2px 8px;border-radius:999px;background:rgba(255,255,255,.08);margin-left:8px;font-size:12px}
.answer-key{display:none;margin-top:8px;opacity:.9}
.answer-key b{color:var(--accent)}
.show-answers .answer-key{display:block}
.actions{position:sticky;bottom:0;background:linear-gradient(180deg,rgba(15,26,58,0),rgba(15,26,58,.95));padding:12px 0;margin-top:24px}
.actions .bar{max-width:1000px;margin:0 auto;display:flex;gap:12px;align-items:center;justify-content:space-between}
button{background:var(--accent);border:none;color:#001018;font-weight:700;padding:12px 18px;border-radius:10px;cursor:pointer}
button.secondary{background:transparent;border:1px solid rgba(255,255,255,.35);color:var(--text)}
.score{font-weight:700}
.feedback{margin-top:8px;font-size:14px}
.correct{border-color:rgba(33,193,122,.6) !important}
.incorrect{border-color:rgba(255,93,115,.75) !important}
.footer{opacity:.8;font-size:12px;text-align:center;padding:16px}
.config-section{background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:20px;margin:16px 0}
.config-section h3{margin-bottom:16px;color:var(--accent)}
textarea{width:100%;min-height:300px;background:#121a34;border:1px solid rgba(255,255,255,.15);border-radius:8px;padding:12px;color:var(--text);font-family:monospace;font-size:13px;resize:vertical}
.btn-group{display:flex;gap:12px;margin-top:12px;flex-wrap:wrap}
.info-box{background:rgba(91,192,190,.1);border:1px solid rgba(91,192,190,.3);border-radius:8px;padding:12px;margin-top:12px;font-size:13px;line-height:1.6}
.error-box{background:rgba(255,93,115,.1);border:1px solid rgba(255,93,115,.3);border-radius:8px;padding:12px;margin-top:12px;color:#ff8ba1}
@media (min-width: 720px){.options{grid-template-columns:1fr 1fr}}
</style>
</head>
<body>
  <div class="header">
    <a href="index.html" class="back-btn">‚Üê Volver al inicio</a>
    <h1 id="mainTitle">Test Interactivo ¬∑ Configurable</h1>
    <div class="badge">Pega el HTML de las preguntas</div>
  </div>
  
  <div class="container">
    <!-- Configuration section -->
    <div class="config-section" id="configSection">
      <h3>üìù Configuraci√≥n del Test</h3>
      <p style="margin-bottom:12px;opacity:.9">Pega aqu√≠ el HTML con las preguntas en el formato que ya tienes:</p>
      
      <textarea id="htmlInput" placeholder='Ejemplo:
<!-- PREGUNTA 1 -->
<div class="question" data-qid="1" data-answer="D">
  <h3>1) ¬øCu√°l es el objeto del Reglamento?</h3>
  <div class="options">
    <label><input type="radio" name="q1" value="A"> A) Opci√≥n A...</label>
    <label><input type="radio" name="q1" value="B"> B) Opci√≥n B...</label>
    <label><input type="radio" name="q1" value="C"> C) Opci√≥n C...</label>
    <label><input type="radio" name="q1" value="D"> D) Opci√≥n D...</label>
  </div>
  <div class="meta">Respuesta correcta: <strong>D</strong></div>
</div>'></textarea>

      <div class="btn-group">
        <button onclick="cargarTest()">Cargar Test</button>
        <button class="secondary" onclick="cargarEjemplo()">Cargar Ejemplo</button>
        <button class="secondary" onclick="limpiarHTML()">Limpiar</button>
      </div>

      <div class="info-box">
        <strong>üí° Instrucciones:</strong><br>
        ‚Ä¢ Solo pega el HTML de las preguntas (los bloques &lt;div class="question"&gt;)<br>
        ‚Ä¢ El sistema detecta autom√°ticamente las respuestas correctas del atributo <code>data-answer</code><br>
        ‚Ä¢ No necesitas editar nada, solo copiar y pegar<br>
        ‚Ä¢ Puedes poner el t√≠tulo del test al principio con un comentario: <code>&lt;!-- TITULO: Mi Test --&gt;</code>
      </div>

      <div id="errorBox" class="error-box" style="display:none"></div>
    </div>

    <!-- Questions container (generated dynamically) -->
    <div id="questionsContainer"></div>

    <!-- Test actions -->
    <div class="actions" id="actionsBar" style="display:none">
      <div class="bar">
        <div class="score">Puntuaci√≥n: <span id="score">‚Äî</span></div>
        <div>
          <button onclick="calificar()">Calificar</button>
          <button class="secondary" onclick="reiniciar()">Reiniciar</button>
          <button class="secondary" onclick="toggleRespuestas(this)">Mostrar respuestas</button>
        </div>
      </div>
    </div>

    <div class="footer" id="footerInfo" style="display:none">
      Test generado autom√°ticamente ¬∑ Sistema configurable
    </div>
  </div>

<script>
let respuestas = {};
let respuestasVisibles = false;

function cargarEjemplo() {
  const ejemplo = `<!-- QUESTION 1 -->
<div class="question" data-qid="1" data-answer="D">
  <h3>1) ¬øCu√°l es el objeto del Reglamento?</h3>
  <div class="options">
    <label><input type="radio" name="q1" value="A"> A) El objeto de este Reglamento es establecer reglas operativas generales para que la circulaci√≥n de los trenes se realice de forma segura, eficiente y puntual.</label>
    <label><input type="radio" name="q1" value="B"> B) El objeto de este Reglamento es establecer reglas operativas generales para que la circulaci√≥n de las maniobras se realice de forma segura, eficiente y puntual.</label>
    <label><input type="radio" name="q1" value="C"> C) El objeto de este Reglamento es establecer reglas operativas generales para que la circulaci√≥n de los trenes y de las maniobras se realice de forma segura y eficiente.</label>
    <label><input type="radio" name="q1" value="D"> D) El objeto de este Reglamento es establecer reglas operativas generales para que la circulaci√≥n de los trenes y de las maniobras se realice de forma segura, eficiente y puntual.</label>
  </div>
  <div class="meta">Respuesta correcta: <strong>D</strong></div>
</div>

<!-- QUESTION 2 -->
<div class="question" data-qid="2" data-answer="B">
  <h3>2) ¬øCu√°l es el objetivo del RCF?</h3>
  <div class="options">
    <label><input type="radio" name="q2" value="A"> A) ...unificando los criterios de operaci√≥n de los distintos AI en ancho convencional.</label>
    <label><input type="radio" name="q2" value="B"> B) ...unificando los criterios de operaci√≥n de los distintos AI en los distintos anchos de la Red.</label>
    <label><input type="radio" name="q2" value="C"> C) ...unificando los criterios de operaci√≥n de los distintos AI en ancho internacional.</label>
    <label><input type="radio" name="q2" value="D"> D) ...unificando los criterios de operaci√≥n de los distintos AI y el responsable de circulaci√≥n...</label>
  </div>
  <div class="meta">Respuesta correcta: <strong>B</strong></div>
</div>

<!-- QUESTION 3 -->
<div class="question" data-qid="3" data-answer="A">
  <h3>3) ¬øDe qui√©n es la responsabilidad de la explotaci√≥n segura del sistema ferroviario?</h3>
  <div class="options">
    <label><input type="radio" name="q3" value="A"> A) Corresponde a los AI y a las EF.</label>
    <label><input type="radio" name="q3" value="B"> B) Corresponde al CTC.</label>
    <label><input type="radio" name="q3" value="C"> C) Corresponde al CTC y PM.</label>
    <label><input type="radio" name="q3" value="D"> D) Corresponde al responsable de circulaci√≥n.</label>
  </div>
  <div class="meta">Respuesta correcta: <strong>A</strong></div>
</div>`;
  document.getElementById('htmlInput').value = ejemplo;
}

function limpiarHTML() {
  document.getElementById('htmlInput').value = '';
  document.getElementById('errorBox').style.display = 'none';
}

function cargarTest() {
  const input = document.getElementById('htmlInput').value.trim();
  const errorBox = document.getElementById('errorBox');
  
  if (!input) {
    errorBox.textContent = '‚ùå Por favor, pega el HTML de las preguntas';
    errorBox.style.display = 'block';
    return;
  }

  try {
    // Crear un contenedor temporal para parsear el HTML
    const temp = document.createElement('div');
    temp.innerHTML = input;
    
    const preguntas = temp.querySelectorAll('.question');
    
    if (preguntas.length === 0) {
      throw new Error('No se encontraron preguntas en el HTML. Aseg√∫rate de que tienen la clase "question"');
    }

    // Search for custom title in comments
    const tituloMatch = input.match(/<!--\s*TITULO:\s*(.+?)\s*-->/i);
    if (tituloMatch) {
      document.getElementById('mainTitle').textContent = tituloMatch[1].trim();
    }

    respuestas = {};
    const container = document.getElementById('questionsContainer');
    container.innerHTML = '';

    preguntas.forEach(pregunta => {
      const qid = pregunta.dataset.qid;
      const respuestaCorrecta = pregunta.dataset.answer;
      respuestas[qid] = respuestaCorrecta;

      const card = document.createElement('div');
      card.className = 'card question';
      card.dataset.qid = qid;

      const titulo = pregunta.querySelector('h3').textContent;
      const opciones = pregunta.querySelectorAll('.options label');

      let opcionesHTML = '';
      opciones.forEach(opt => {
        const input = opt.querySelector('input');
        const letra = input.value;
        const texto = opt.textContent.trim();
        opcionesHTML += `
          <label class="option">
            <input type="radio" name="q${qid}" value="${letra}" />
            <div>${texto}</div>
          </label>
        `;
      });

      card.innerHTML = `
        <div class="q-title">${titulo}</div>
        <div class="options">${opcionesHTML}</div>
        <div class="answer-key">Respuesta: <b>${respuestaCorrecta}</b></div>
        <div class="feedback"></div>
      `;

      container.appendChild(card);
    });

    errorBox.style.display = 'none';
    document.getElementById('configSection').style.display = 'none';
    document.getElementById('actionsBar').style.display = 'block';
    document.getElementById('footerInfo').style.display = 'block';
    window.scrollTo({top: 0, behavior: 'smooth'});
    
  } catch (e) {
    errorBox.textContent = '‚ùå Error al procesar el HTML: ' + e.message;
    errorBox.style.display = 'block';
  }
}

function calificar() {
  let total = 0, correctas = 0;
  
  document.querySelectorAll('.question').forEach(card => {
    total++;
    const qid = card.dataset.qid;
    const seleccionada = card.querySelector('input[type=radio]:checked');
    const correcta = respuestas[qid];
    
    card.querySelectorAll('.option').forEach(o => o.classList.remove('correct','incorrect'));
    
    if (seleccionada) {
      const letra = seleccionada.value;
      if (letra === correcta) {
        correctas++;
        seleccionada.closest('.option').classList.add('correct');
        card.querySelector('.feedback').textContent = '‚úî Correcta';
        card.querySelector('.feedback').style.color = '#21c17a';
      } else {
        seleccionada.closest('.option').classList.add('incorrect');
        card.querySelector('.feedback').innerHTML = '‚úñ Incorrecta ¬∑ Correcta: <b>' + correcta + '</b>';
        card.querySelector('.feedback').style.color = '#ff8ba1';
        const corr = card.querySelector('input[value="' + correcta + '"]');
        if (corr) corr.closest('.option').classList.add('correct');
      }
    } else {
      card.querySelector('.feedback').textContent = 'Sin respuesta';
      card.querySelector('.feedback').style.color = '#ffc107';
    }
  });
  
  const porcentaje = Math.round((correctas/total)*100);
  document.getElementById('score').textContent = `${correctas} / ${total} (${porcentaje}%)`;
}

function reiniciar() {
  document.querySelectorAll('input[type=radio]').forEach(r => r.checked = false);
  document.querySelectorAll('.option').forEach(o => o.classList.remove('correct','incorrect'));
  document.querySelectorAll('.feedback').forEach(f => {f.textContent=''; f.removeAttribute('style')});
  document.getElementById('score').textContent = '‚Äî';
}

function toggleRespuestas(btn) {
  respuestasVisibles = !respuestasVisibles;
  document.body.classList.toggle('show-answers', respuestasVisibles);
  btn.textContent = respuestasVisibles ? 'Ocultar respuestas' : 'Mostrar respuestas';
  
  if (respuestasVisibles) {
    document.querySelectorAll('.question').forEach(card => {
      const qid = card.dataset.qid;
      const correcta = respuestas[qid];
      card.querySelectorAll('.option').forEach(o => o.classList.remove('correct'));
      const corr = card.querySelector('input[value="' + correcta + '"]');
      if (corr) corr.closest('.option').classList.add('correct');
    });
  } else {
    document.querySelectorAll('.option').forEach(o => o.classList.remove('correct'));
  }
}
</script>
</body>
</html>
}
