<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ESTE NO FUNCIONA ESTOY PROBANDO UNAS COSAS</title>
<style>
:root{--c1:#0b5fff;--bad:#c2272d;--bg:#f7f9fc}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;background:var(--bg);margin:0;padding:2rem}
header,footer{max-width:1000px;margin:0 auto 1rem}
main{max-width:1000px;margin:0 auto;background:#fff;border-radius:.75rem;box-shadow:0 6px 20px rgba(0,0,0,.06);padding:1rem}
.q{border:1px solid #e6e8ee;border-radius:.6rem;padding:1rem;margin:1rem 0}
.opts{display:grid;gap:.35rem}
label{display:flex;gap:.5rem;align-items:flex-start;padding:.45rem .6rem;border-radius:.5rem;border:1px solid #eaecef}
input[type=radio]{margin-top:.2rem}
.correct{background:#eaf7ef;border-color:#bfe5c9}
.incorrect{background:#fde9eb;border-color:#f6c5cc}
.meta{font-size:.9rem;color:#667085}
button{background:var(--c1);color:#fff;border:0;padding:.6rem .9rem;border-radius:.5rem;cursor:pointer;margin-right:.4rem}
button.secondary{background:#e8eefc;color:#163368}
button.danger{background:var(--bad)}
.badge{display:inline-block;background:#eef2ff;color:#1f2a68;padding:.15rem .5rem;border-radius:.5rem;margin-left:.4rem}
</style>
</head>
<body>
<header>
  <h1>Test RCF Libro 1 ‚Äì Interactivo</h1>
  <div>Preguntas detectadas: <strong id="nq"></strong> <span class="badge" id="integridad"></span></div>
  <div class="toolbar">
    <button id="shuffle">üîÄ Barajar</button>
    <button id="check">‚úÖ Corregir</button>
    <button class="secondary" id="showKey">üóùÔ∏è Mostrar/Ocultar soluciones</button>
    <button class="danger" id="reset">‚Ü∫ Reiniciar</button>
  </div>
</header>
<main id="app"></main>
<footer>
  <small>Compilado manualmente con 25 preguntas y gabarito.</small>
</footer>
<script>


const DATA = [
  {
    enunciado: "¬øCu√°l es el objeto del Reglamento?",
    opciones: [
      { texto: "El objeto de este Reglamento es establecer reglas operativas generales para que la circulaci√≥n de los trenes se realice de forma segura, eficiente y puntual.", correcta: false },
      { texto: "El objeto de este Reglamento es establecer reglas operativas generales para que la circulaci√≥n de las maniobras se realice de forma segura, eficiente y puntual.", correcta: false },
      { texto: "El objeto de este Reglamento es establecer reglas operativas generales para que la circulaci√≥n de los trenes y de las maniobras se realice de forma segura y eficiente.", correcta: false },
      { texto: "El objeto de este Reglamento es establecer reglas operativas generales para que la circulaci√≥n de los trenes y de las maniobras se realice de forma segura, eficiente y puntual.", correcta: true }
    ]
  },
  {
    enunciado: "¬øCu√°l es el objetivo del RCF?",
    opciones: [
      { texto: "...unificando los criterios de operaci√≥n de los distintos AI en ancho convencional.", correcta: false },
      { texto: "...unificando los criterios de operaci√≥n de los distintos AI en los distintos anchos de la Red.", correcta: true },
      { texto: "...unificando los criterios de operaci√≥n de los distintos AI en ancho internacional.", correcta: false },
      { texto: "...unificando los criterios de operaci√≥n de los distintos AI y el responsable de circulaci√≥n...", correcta: false }
    ]
  },
  {
    enunciado: "¬øDe qui√©n es la responsabilidad de la explotaci√≥n segura del sistema ferroviario?",
    opciones: [
      { texto: "Corresponde a los AI y a las EF.", correcta: true },
      { texto: "Corresponde al CTC.", correcta: false },
      { texto: "Corresponde al CTC y PM.", correcta: false },
      { texto: "Corresponde al responsable de circulaci√≥n.", correcta: false }
    ]
  },
  {
    enunciado: "¬øQui√©n tiene que establecer las reglas internas, conforme con la normativa vigente?",
    opciones: [
      { texto: "AI y EF.", correcta: true },
      { texto: "EF y AESF.", correcta: false },
      { texto: "AESF y AI.", correcta: false },
      { texto: "AESF.", correcta: false }
    ]
  },
  {
    enunciado: "El Reglamento es conforme con lo prescrito:",
    opciones: [
      { texto: "En las ETI, LSF.", correcta: false },
      { texto: "En las normas de desarrollo.", correcta: false },
      { texto: "En las ETI, LSF y sus normas de desarrollo.", correcta: true },
      { texto: "En la LSF y sus normas de desarrollo.", correcta: false }
    ]
  }
];

const EXPECTED = 25;
const app = document.getElementById('app');
const nq = document.getElementById('nq');
const integridad = document.getElementById('integridad');

function shuffleInPlace(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
}

function render(){
  app.innerHTML='';
  nq.textContent = DATA.length;
  integridad.textContent = (DATA.length===EXPECTED ? 'OK' : `Esperadas ${EXPECTED}`);

  DATA.forEach((q, idx)=>{
    const box=document.createElement('div');
    box.className='q';
    const h=document.createElement('h3');
    h.textContent = `${idx+1}) ${q.enunciado}`;
    box.appendChild(h);

    const optsDiv=document.createElement('div');
    optsDiv.className='opts';

    let opciones = q.opciones.map(o=>({...o}));
    if(q._shuffle){
      shuffleInPlace(opciones);
      q._shuffledOptions = opciones; // <-- guarda el orden barajado
    }

    const letras = ['a','b','c','d'];
    opciones.forEach((o,i)=>{
      const lab=document.createElement('label');
      const input=document.createElement('input');
      input.type='radio';
      input.name=`q${idx}`;
      input.checked = false;
      input.value = i; // usamos el √≠ndice para identificar
      const span=document.createElement('span');
      span.textContent = `${letras[i]}) ${o.texto}`;
      lab.appendChild(input);
      lab.appendChild(span);

      // marcar correcta si _showKey
      if(q._showKey && o.correcta) lab.classList.add('correct');

      optsDiv.appendChild(lab);
    });

    box.appendChild(optsDiv);

    const meta=document.createElement('div');
    meta.className='meta';
    const correctaIdx = q.opciones.findIndex(opt => opt.correcta);
    meta.innerHTML = `Respuesta correcta: <strong>${letras[correctaIdx]})</strong>`;
    if(!q._showKey) meta.style.display='none';
    box.appendChild(meta);

    app.appendChild(box);
  });
}
  
function correct(){
  let ok = 0, total = 0;
  const letras = ['a','b','c','d'];

  const boxes = app.querySelectorAll('.q');
  boxes.forEach((box, qi) => {
    const q = DATA[qi];
    total++;

    const labels = box.querySelectorAll('label');
    labels.forEach(l => l.classList.remove('correct','incorrect'));

    const sel = box.querySelector('input[type=radio]:checked');
    if(sel) {
      const selIdx = parseInt(sel.value);       // √≠ndice del input seleccionado
      const correctaIdx = q.opciones.findIndex(o => o.correcta); // √≠ndice correcto
      if(selIdx === correctaIdx) {
        ok++;
        sel.parentElement.classList.add('correct');
      } else {
        sel.parentElement.classList.add('incorrect');
      }
    }

    const selIdx = parseInt(sel.value);
    const selectedOption = q._shuffle ? q._shuffledOptions[selIdx] : q.opciones[selIdx];
      
      // marcar todas las correctas
      labels.forEach((l, li) => {
        const opt = q._shuffle ? q._shuffledOptions[li] : q.opciones[li];
        if(opt.correcta) l.classList.add('correct');
      });

      if(selectedOption.correcta){
        ok++;
      } else {
        sel.parentElement.classList.add('incorrect');
      }
    }
  });

  alert(`Puntuaci√≥n: ${ok} / ${total}`);
}
const btnShuffle=document.getElementById('shuffle');
const btnCheck=document.getElementById('check');
const btnKey=document.getElementById('showKey');
const btnReset=document.getElementById('reset');

btnShuffle.onclick=()=>{ DATA.forEach(q=>{q._shuffle=!q._shuffle}); render(); };
btnKey.onclick=()=>{ DATA.forEach(q=>{q._showKey=!q._showKey}); render(); };
btnCheck.onclick=correct;
btnReset.onclick=()=>{
  document.querySelectorAll('input[type=radio]').forEach(i=>i.checked=false);
  DATA.forEach(q=>{q._showKey=false; q._shuffle=false});
  render();
};

render();
</script>
</body>
</html>
